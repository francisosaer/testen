<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Opmeting App</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    padding:15px;
    background:#f4f6f8;
}

h1{
    text-align:center;
}

input, button{
    width:100%;
    padding:10px;
    margin:5px 0;
    font-size:16px;
}

button{
    background:#00468c;
    color:white;
    border:none;
    border-radius:5px;
}

button:disabled{
    background:gray;
}

.element{
    background:white;
    padding:15px;
    margin:15px 0;
    border-radius:8px;
    position:relative;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
}

.verwijderBtn{
    position:absolute;
    top:10px;
    right:10px;
    background:#c0392b;
    width:auto;
    padding:6px 10px;
    font-size:13px;
}

img{
    max-width:100%;
    margin-top:10px;
    border-radius:6px;
}
</style>
</head>

<body>

<h1>Opmeting</h1>

<label>Klant</label>
<input type="text" id="klant" placeholder="Naam klant">

<button onclick="voegElementToe()">Nieuw Element</button>

<div id="container"></div>

<button onclick="maakPDF()">Project als PDF</button>
<button id="mailBtn" onclick="mailProject()" disabled>Project mailen</button>

<script>

function voegElementToe(){

    const container = document.getElementById("container");

    const div = document.createElement("div");
    div.className="element";

    div.innerHTML = `
        <button class="verwijderBtn" onclick="verwijderElement(this)">Element verwijderen</button>
        <h3>Element</h3>
        <input type="text" placeholder="Breedte">
        <input type="text" placeholder="Hoogte">
        <input type="text" placeholder="Type">
        <input type="file" accept="image/*" capture="environment" onchange="toonFoto(event,this)">
        <img>
    `;

    container.appendChild(div);
}

function verwijderElement(btn){
    if(confirm("Bent u zeker dat u dit element wil verwijderen?")){
        btn.parentElement.remove();
    }
}

function toonFoto(event,input){
    const reader = new FileReader();
    reader.onload = function(){
        input.parentElement.querySelector("img").src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
}

async function maakPDF(){

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF("p","mm","a4");

    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();

    let y = 20;

    // HEADER
    const logo = new Image();
    logo.src="logo.png";

    await new Promise(resolve=>{
        logo.onload=resolve;
    });

    doc.addImage(logo,"PNG",15,12,35,15);

    doc.setFont("helvetica","bold");
    doc.setFontSize(20);
    doc.text("OPMETINGSVERSLAG",pageWidth/2,20,{align:"center"});

    doc.setFontSize(11);
    doc.setFont("helvetica","normal");

    const klant=document.getElementById("klant").value || "-";

    const vandaag=new Date();
    const datum=
        String(vandaag.getDate()).padStart(2,"0")+"/"+
        String(vandaag.getMonth()+1).padStart(2,"0")+"/"+
        vandaag.getFullYear();

    doc.text("Klant: "+klant,15,38);
    doc.text("Datum: "+datum,15,44);

    doc.setDrawColor(0,70,140);
    doc.setLineWidth(0.7);
    doc.line(15,48,pageWidth-15,48);

    y=58;

    const elementen=document.querySelectorAll(".element");
    let nr=1;

    for(let el of elementen){

        if(y>pageHeight-60){
            doc.addPage();
            y=20;
        }

        doc.setFillColor(245,245,245);
        doc.rect(15,y-5,pageWidth-30,10,"F");

        doc.setFont("helvetica","bold");
        doc.setFontSize(12);
        doc.text("Element "+nr,18,y+2);
        y+=10;

        doc.setFont("helvetica","normal");
        doc.setFontSize(10);

        const inputs=el.querySelectorAll("input");

        inputs.forEach(input=>{
            if(input.type!=="file" && input.value){
                doc.text(input.placeholder+": "+input.value,20,y);
                y+=6;
            }
        });

        const imgEl=el.querySelector("img");

        if(imgEl && imgEl.src){

            await new Promise(resolve=>{
                const img=new Image();
                img.src=imgEl.src;

                img.onload=function(){

                    const maxWidth=90;
                    const maxHeight=65;

                    let w=img.width;
                    let h=img.height;

                    const ratio=Math.min(maxWidth/w,maxHeight/h);

                    w*=ratio;
                    h*=ratio;

                    doc.addImage(img,"JPEG",20,y,w,h);
                    y+=h+8;

                    resolve();
                }
            });
        }

        doc.setDrawColor(220);
        doc.setLineWidth(0.4);
        doc.line(15,y,pageWidth-15,y);
        y+=12;

        nr++;
    }

    // FOOTER
    const totalPages=doc.getNumberOfPages();

    for(let i=1;i<=totalPages;i++){
        doc.setPage(i);

        doc.setFontSize(8);
        doc.setTextColor(120);

        doc.text(
        "Ramen Blondeel - Leopoldlaan 91 9900 Eeklo - Tel 09/343.82.70 - info@ramen-blondeel.be",
        pageWidth/2,
        pageHeight-10,
        {align:"center"}
        );

        doc.text(
        "Pagina "+i+" van "+totalPages,
        pageWidth-15,
        pageHeight-5,
        {align:"right"}
        );
    }

    let klantNaam=klant.trim();
    if(!klantNaam){klantNaam="Onbekende_Klant";}
    klantNaam=klantNaam.replace(/\s+/g,"_");

    doc.save(`Opmeting_${klantNaam}_${vandaag.getFullYear()}-${String(vandaag.getMonth()+1).padStart(2,"0")}-${String(vandaag.getDate()).padStart(2,"0")}.pdf`);

    document.getElementById("mailBtn").disabled=false;
}

function mailProject(){
    alert("Open nu je mailprogramma en voeg de gegenereerde PDF toe als bijlage.");
}

</script>

</body>
</html>


